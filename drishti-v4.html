<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>AuctionDunia Style + Immersive Viewer</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pannellum@2.5.6/build/pannellum.css"/>
<script src="https://cdn.jsdelivr.net/npm/pannellum@2.5.6/build/pannellum.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500&family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }
:root {
  --bg: #f5f7fb;
  --card: #ffffff;
  --ink: #1f2937;
  --muted: #6b7280;
  --line: #e5e7eb;
  --brand: #0f766e;
  --brand-soft: #e6fffb;
  --viewer-bg: #111827;
  --viewer-line: rgba(255,255,255,.18);
  --viewer-chip: rgba(17,24,39,.72);
}
html, body {
  width: 100%;
  background: var(--bg);
  color: var(--ink);
  font-family: 'DM Sans', sans-serif;
}
.page {
  min-height: 100vh;
}
.top-nav {
  height: 60px;
  border-bottom: 1px solid var(--line);
  background: #fff;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 0 16px;
}
.brand {
  width: min(1180px, 100%);
  font-weight: 700;
  letter-spacing: .02em;
}
.content {
  width: min(1180px, 100%);
  margin: 20px auto;
  padding: 0 16px 30px;
}
.breadcrumb {
  color: var(--muted);
  font-size: 13px;
  margin-bottom: 10px;
}
.title {
  font-size: clamp(22px, 2.5vw, 30px);
  font-weight: 700;
  margin-bottom: 6px;
}
.meta {
  color: var(--muted);
  font-size: 14px;
  margin-bottom: 18px;
}
.layout {
  display: grid;
  grid-template-columns: minmax(0, 1fr) 340px;
  gap: 16px;
}
.card {
  border: 1px solid var(--line);
  background: var(--card);
  border-radius: 12px;
  overflow: hidden;
}
.media-head {
  border-bottom: 1px solid var(--line);
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px;
}
.mode-pill {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  font-size: 13px;
  font-weight: 600;
  color: var(--brand);
  background: var(--brand-soft);
  border: 1px solid #d6f5f2;
  border-radius: 999px;
  padding: 7px 12px;
}
.head-actions {
  display: flex;
  gap: 8px;
}
.btn {
  border: 1px solid var(--line);
  background: #fff;
  color: #111827;
  border-radius: 8px;
  font-size: 12px;
  font-weight: 600;
  padding: 8px 10px;
  cursor: pointer;
}
.btn:hover { border-color: #cbd5e1; }
#viewerWrap {
  position: relative;
  background: var(--viewer-bg);
}
#pano {
  width: 100%;
  aspect-ratio: 16 / 9;
  min-height: 340px;
}
.viewer-overlay {
  position: absolute;
  top: 10px;
  left: 10px;
  right: 10px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  pointer-events: none;
}
.scene-name,
.counter {
  pointer-events: auto;
  border: 1px solid var(--viewer-line);
  background: var(--viewer-chip);
  color: #f9fafb;
  border-radius: 999px;
  font-size: 12px;
  padding: 6px 10px;
  backdrop-filter: blur(5px);
}
.viewer-foot {
  border-top: 1px solid var(--line);
  background: #fff;
  padding: 10px;
}
#roommap {
  display: flex;
  gap: 8px;
  overflow-x: auto;
}
.rm-chip {
  border: 1px solid #d1d5db;
  background: #fff;
  color: #374151;
  border-radius: 999px;
  font-size: 12px;
  padding: 7px 11px;
  white-space: nowrap;
  cursor: pointer;
}
.rm-chip.active {
  background: #111827;
  color: #fff;
  border-color: #111827;
}
.viewer-tools {
  margin-top: 10px;
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
}
.sidebar {
  padding: 14px;
}
.price {
  font-size: 26px;
  font-weight: 700;
  margin-bottom: 2px;
}
.price-note {
  color: var(--muted);
  font-size: 12px;
  margin-bottom: 14px;
}
.kv {
  display: grid;
  grid-template-columns: 1fr auto;
  gap: 8px;
  font-size: 14px;
  padding: 8px 0;
  border-top: 1px dashed #e5e7eb;
}
.kv:first-of-type { border-top: none; }
.kv span:last-child { color: #111827; font-weight: 600; }
.cta {
  margin-top: 14px;
  width: 100%;
  border: 1px solid #0f766e;
  background: #0f766e;
  color: #fff;
  border-radius: 8px;
  padding: 10px;
  font-weight: 700;
  cursor: pointer;
}
.cta.secondary {
  background: #fff;
  color: #0f766e;
}
.section {
  margin-top: 16px;
  padding: 14px;
}
.section h2 {
  font-size: 16px;
  margin-bottom: 8px;
}
.section p {
  color: #4b5563;
  line-height: 1.6;
  font-size: 14px;
}

.pnlm-controls-container,
.pnlm-title-box,
.pnlm-load-button,
.pnlm-orientation-button { display: none !important; }
.pnlm-hotspot {
  background: rgba(255,255,255,.85) !important;
  border: 2px solid #111827 !important;
  width: 16px !important;
  height: 16px !important;
  border-radius: 50% !important;
}

@media (max-width: 980px) {
  .layout { grid-template-columns: 1fr; }
}
@media (max-width: 640px) {
  .content { margin-top: 12px; }
  #pano { min-height: 280px; }
  .meta { font-size: 13px; }
}
</style>
</head>
<body>
<div class="page">
  <div class="top-nav">
    <div class="brand">AuctionDunia</div>
  </div>

  <main class="content">
    <div class="breadcrumb">Home / Properties / Bengaluru</div>
    <h1 class="title">2BHK Apartment, Koramangala</h1>
    <div class="meta">Auction Date: March 12, 2026 · Property ID: 364</div>

    <div class="layout">
      <section class="card">
        <div class="media-head">
          <div class="mode-pill">Immersive Tour Enabled</div>
          <div class="head-actions">
            <button class="btn" id="playBtn">Play</button>
            <button class="btn" id="fullscreenBtn">Fullscreen</button>
            <button class="btn" onclick="document.getElementById('fileIn').click()">Upload 360</button>
            <button class="btn" onclick="loadDemo()">Load Demo</button>
          </div>
        </div>

        <div id="viewerWrap">
          <div id="pano"></div>
          <div class="viewer-overlay">
            <div class="scene-name" id="sceneName">—</div>
            <div class="counter" id="sceneCounter">0 / 0</div>
          </div>
        </div>

        <div class="viewer-foot">
          <div id="roommap"></div>
          <div class="viewer-tools">
            <button class="btn" onclick="prevScene()">Previous Room</button>
            <button class="btn" onclick="nextScene()">Next Room</button>
            <input type="file" id="fileIn" accept="image/*" multiple style="display:none" onchange="onFiles(event)">
          </div>
        </div>
      </section>

      <aside class="card sidebar">
        <div class="price">₹ 85,00,000</div>
        <div class="price-note">Reserve price</div>

        <div class="kv"><span>Area</span><span>1,150 sq.ft</span></div>
        <div class="kv"><span>Bedrooms</span><span>2</span></div>
        <div class="kv"><span>Bathrooms</span><span>2</span></div>
        <div class="kv"><span>Locality</span><span>Koramangala</span></div>
        <div class="kv"><span>City</span><span>Bengaluru</span></div>

        <button class="cta">Bid In Auction</button>
        <button class="cta secondary">Download Documents</button>
      </aside>
    </div>

    <section class="card section">
      <h2>Property Description</h2>
      <p>
        This layout keeps the property detail UI simple, while replacing a static photo carousel with your immersive 360 room navigation.
        Use room chips or hotspot points inside the viewer to move between spaces.
      </p>
    </section>
  </main>
</div>

<script>
let viewer = null;
let tourData = null;
let currentId = null;
let autoPlayTimer = null;
const AUTO_PLAY_MS = 24000;
const AUTO_ROTATE_SPEED = 15;

const DEMO_TOUR = {
  property: { name: "2BHK · Koramangala", meta: "1,150 sq ft · Auction Mar 12" },
  scenes: {
    living: {
      title: "Living Room",
      panorama: "Hall.jpg",
      hotspots: [
        { pitch: -12, yaw: 110, toScene: "kitchen" },
        { pitch: -12, yaw: 260, toScene: "bedroom" }
      ]
    },
    kitchen: {
      title: "Kitchen",
      panorama: "kitchen.jpg",
      hotspots: [
        { pitch: -10, yaw: 20, toScene: "living" },
        { pitch: -10, yaw: 190, toScene: "bedroom" }
      ]
    },
    bedroom: {
      title: "Bedroom",
      panorama: "Myrpom.jpg",
      hotspots: [
        { pitch: -10, yaw: 60, toScene: "kitchen" },
        { pitch: -10, yaw: 240, toScene: "living" }
      ]
    }
  }
};

function buildScenes(tour) {
  const out = {};
  Object.entries(tour.scenes).forEach(([id, s]) => {
    out[id] = {
      type: "equirectangular",
      panorama: s.panorama,
      hotSpots: (s.hotspots || []).map((hs) => ({
        pitch: hs.pitch,
        yaw: hs.yaw,
        type: "scene",
        sceneId: hs.toScene,
      })),
    };
  });
  return out;
}

function launch(tour) {
  stopAutoPlay();
  tourData = tour;
  const firstId = Object.keys(tour.scenes)[0];
  currentId = firstId;

  if (viewer) {
    viewer.destroy();
    viewer = null;
  }

  viewer = pannellum.viewer("pano", {
    default: {
      firstScene: firstId,
      autoLoad: true,
      showZoomCtrl: false,
      showFullscreenCtrl: false,
      keyboardZoom: false,
      mouseZoom: true,
      hfov: 95,
      friction: 0.5,
      autoRotate: 0,
      sceneFadeDuration: 700,
    },
    scenes: buildScenes(tour),
  });

  viewer.on("scenechange", (id) => {
    currentId = id;
    syncUi();
    if (autoPlayTimer) {
      startSceneRotation();
    }
  });

  viewer.on("load", () => {
    syncUi();
    buildRoomMap(tour);
  });

  syncUi();
}

function setPlayButton(isPlaying) {
  const btn = document.getElementById("playBtn");
  btn.textContent = isPlaying ? "Pause" : "Play";
}

function startSceneRotation() {
  if (!viewer || !viewer.startAutoRotate) return;
  viewer.stopAutoRotate?.();
  // Delay a bit so rotation starts after scene load/fade.
  setTimeout(() => {
    if (!autoPlayTimer || !viewer) return;
    viewer.startAutoRotate(AUTO_ROTATE_SPEED);
  }, 450);
}

function stopAutoPlay() {
  if (autoPlayTimer) {
    clearInterval(autoPlayTimer);
    autoPlayTimer = null;
  }
  viewer?.stopAutoRotate?.();
  setPlayButton(false);
}

function startAutoPlay() {
  if (!tourData) return;
  stopAutoPlay();
  const count = Object.keys(tourData.scenes).length;
  autoPlayTimer = setInterval(() => {
    if (count > 1) {
      nextScene();
    }
  }, AUTO_PLAY_MS);
  setPlayButton(true);
  startSceneRotation();
}

function toggleAutoPlay() {
  if (autoPlayTimer) {
    stopAutoPlay();
  } else {
    startAutoPlay();
  }
}

function syncUi() {
  if (!tourData || !currentId) return;
  const ids = Object.keys(tourData.scenes);
  const scene = tourData.scenes[currentId];
  const idx = ids.indexOf(currentId);
  document.getElementById("sceneName").textContent = scene?.title || "Room";
  document.getElementById("sceneCounter").textContent = `${idx + 1} / ${ids.length}`;
  document.querySelectorAll(".rm-chip").forEach((chip) => {
    chip.classList.toggle("active", chip.dataset.id === currentId);
  });
}

function goToScene(id) {
  if (!viewer || !tourData || !tourData.scenes[id] || id === currentId) return;
  viewer.loadScene(id);
}

function buildRoomMap(tour) {
  const el = document.getElementById("roommap");
  el.innerHTML = "";
  Object.entries(tour.scenes).forEach(([id, s]) => {
    const chip = document.createElement("button");
    chip.className = "rm-chip" + (id === currentId ? " active" : "");
    chip.dataset.id = id;
    chip.type = "button";
    chip.textContent = s.title;
    chip.onclick = () => goToScene(id);
    el.appendChild(chip);
  });
}

function nextScene() {
  if (!tourData || !currentId) return;
  const ids = Object.keys(tourData.scenes);
  const idx = ids.indexOf(currentId);
  goToScene(ids[(idx + 1) % ids.length]);
}

function prevScene() {
  if (!tourData || !currentId) return;
  const ids = Object.keys(tourData.scenes);
  const idx = ids.indexOf(currentId);
  goToScene(ids[(idx - 1 + ids.length) % ids.length]);
}

function onFiles(e) {
  const files = Array.from(e.target.files || []);
  if (!files.length) return;

  const names = ["Living Room", "Kitchen", "Bedroom", "Bathroom", "Balcony", "Study", "Dining"];
  const ids = files.map((_, i) => `room_${i}`);

  const tour = {
    property: { name: "Uploaded Property", meta: "" },
    scenes: {}
  };

  files.forEach((file, i) => {
    const raw = file.name.replace(/\.[^.]+$/, "").replace(/[-_]/g, " ");
    const title = raw.length > 3 ? raw : (names[i] || `Room ${i + 1}`);
    const url = URL.createObjectURL(file);

    const hotspots = [];
    if (i < files.length - 1) hotspots.push({ pitch: -14, yaw: 0, toScene: ids[i + 1] });
    if (i > 0) hotspots.push({ pitch: -14, yaw: 180, toScene: ids[i - 1] });

    tour.scenes[ids[i]] = { title, panorama: url, hotspots };
  });

  launch(tour);
}

function loadDemo() {
  launch(DEMO_TOUR);
}

document.getElementById("playBtn").addEventListener("click", toggleAutoPlay);

document.getElementById("fullscreenBtn").addEventListener("click", () => {
  if (!viewer) return;
  viewer.toggleFullscreen();
});

document.addEventListener("keydown", (e) => {
  if (e.key === "ArrowRight") nextScene();
  if (e.key === "ArrowLeft") prevScene();
});

loadDemo();
</script>
</body>
</html>
